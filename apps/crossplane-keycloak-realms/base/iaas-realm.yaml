apiVersion: realm.keycloak.crossplane.io/v1alpha1
kind: Realm
metadata:
  name: iaas
spec:
  deletionPolicy: Delete
  forProvider:
    displayName: IaaS
    duplicateEmailsAllowed: false
    enabled: true
    passwordPolicy: length(8) and digits(1) and upperCase(1) and lowerCase(1) and specialChars(1) and forceExpiredPasswordChange(365) and notUsername(undefined)
    realm: iaas
    registrationEmailAsUsername: false
    rememberMe: true
    resetPasswordAllowed: false
    securityDefenses:
    - bruteForceDetection:
      - failureFactor: 6
    #   # - maxFailureWaitSeconds:
    #   - maxLoginFailures: 30
    #   # - maxTemporaryLockouts:
    #   # - minimumQuickLoginWaitSeconds:
        permanentLockout: true
    #   - quickLoginCheckMilliSeconds: 1000
    #   # - waitIncrementSeconds: 60
    sslRequired: all
    webAuthnPasswordlessPolicy:
    - attestationConveyancePreference: not specified
      authenticatorAttachment: not specified
      avoidSameAuthenticatorRegister: false
      createTimeout: 0
      relyingPartyEntityName: Keycloak
      relyingPartyId: apps.iaas.wcooke.me
      requireResidentKey: not specified
      signatureAlgorithms:
        - ES512
        - RS512
      userVerificationRequirement: required
    webAuthnPolicy:
    - attestationConveyancePreference: not specified
      authenticatorAttachment: not specified
      avoidSameAuthenticatorRegister: false
      createTimeout: 0
      relyingPartyEntityName: Keycloak
      relyingPartyId: apps.iaas.wcooke.me
      requireResidentKey: not specified
      signatureAlgorithms:
        - ES512
        - RS512
      userVerificationRequirement: required
    verifyEmail: false
  providerConfigRef:
    name: keycloak-provider-config
---
apiVersion: realm.keycloak.crossplane.io/v1alpha1
kind: RealmEvents
metadata:
  name: iaas-events
spec:
  deletionPolicy: Delete
  forProvider:
    adminEventsDetailsEnabled: true
    adminEventsEnabled: true
    eventsEnabled: true
    eventsExpiration: 2592000
    realmIdRef:
      name: iaas
  providerConfigRef:
    name: keycloak-provider-config
---
apiVersion: openidclient.keycloak.crossplane.io/v1alpha1
kind: ClientScope
metadata:
  name: groups
spec:
  deletionPolicy: Delete
  forProvider:
    description: "OpenID Connect scope: include user groups in tokens"
    includeInTokenScope: true
    name: groups
    realmIdRef:
      name: iaas
  providerConfigRef:
    name: keycloak-provider-config
---
apiVersion: realm.keycloak.crossplane.io/v1alpha1
kind: OptionalClientScopes
metadata:
  name: realm-optional-client-scopes
spec:
  deletionPolicy: Delete
  forProvider:
    optionalScopes:
    # Default Scopes
    - address
    - microprofile-jwt
    - offline_access
    - organization
    - phone
    # Custom Scopes
    - groups
    realmIdRef:
      name: iaas
  providerConfigRef:
    name: keycloak-provider-config
---
apiVersion: openidgroup.keycloak.crossplane.io/v1alpha1
kind: GroupMembershipProtocolMapper
metadata:
  name: groups
spec:
  deletionPolicy: Delete
  forProvider:
    addToAccessToken: true
    addToIdToken: true
    addToUserinfo: true
    claimName: groups
    clientScopeIdRef:
      name: groups
    fullPath: false
    name: groups
    realmIdRef:
      name: iaas
  providerConfigRef:
    name: keycloak-provider-config
