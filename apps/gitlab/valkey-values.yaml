serviceAccount:
  create: false

# Network policy to control traffic to the pods
# More info: https://kubernetes.io/docs/concepts/services-networking/network-policies/
networkPolicy: {}

# Resource limits/requests for the main Valkey container
resources: {}
  # Example:
  # limits:
  #   cpu: 100m
  #   memory: 128Mi
  # requests:
  #   cpu: 100m
  #   memory: 128Mi

# Mount additional secrets into the Valkey container
extraValkeySecrets: []

# Mount additional configMaps into the Valkey container
extraValkeyConfigs: []

# Mount extra secrets as volume to init container (deprecated, use extraValkeySecrets)
extraSecretValkeyConfigs: false

# Mount additional emptyDir or hostPath volumes (advanced use)
extraVolumes: []
#  - name: hostpath-volume
#    hostPath:
#      path: /opt/valkey/hostpath-volume/
#      type: DirectoryOrCreate
extraVolumeMounts: []
#  - mountPath: /some/path/
#    name: hostpath-volume

# Content for valkey.conf (will be mounted via ConfigMap)
valkeyConfig: ""

auth:
  # Enable ACL-based authentication
  # IMPORTANT: When authentication is enabled, the 'default' user MUST be defined in either
  # aclUsers or aclConfig. Without a default user, anyone can access the database without
  # credentials, creating a security risk.
  enabled: true

  # Use an existing secret for user passwords. Key defaults to username.
  usersExistingSecret: gitlab-valkey-password

  # Map of users to create with ACL permissions.
  # If usersExistingSecret is set, passwords from the secret take priority over inline passwords.
  # NOTE: If using aclUsers, the 'default' user must be included here.
  aclUsers:
    default:
      permissions: "~* &* +@all"
  # Example:
  # default:
  #   permissions: "~* &* +@all"
  #   password: "secretpass"        # Inline password (fallback if usersExistingSecret not set)
  #   passwordKey: "admin-pwd"      # Key in usersExistingSecret (defaults to username)
  # read-user:
  #   permissions: "~* -@all +@read +ping +info"

  # Inline ACL configuration that will be appended after generated users.
  # NOTE: If using aclConfig, ensure the 'default' user is defined here.
  aclConfig: ""
  # Example:
  # aclConfig: |
  #   user default on >secretpass ~* &* +@all

# Replica configuration for master-replica replication mode
replica:
  enabled: true
  replicas: 2

  # Username for replicas to authenticate to master, ignored if auth.enabled is false.
  # IMPORTANT: When auth.enabled is true, this user MUST be defined in auth.aclUsers.
  # The chart requires this to retrieve the password for replica authentication.
  # The user must have appropriate replication permissions: +psync +replconf +ping
  replicationUser: "default"

  # Replication settings
  # Use diskless replication (sync directly from memory) vs disk-based
  disklessSync: false

  # Write safety - require minimum number of healthy replicas to accept writes
  # Set to 0 to disable this check, or 1+ to require minimum replicas before accepting writes
  # This ensures data durability by requiring at least N replicas to be in sync
  minReplicasToWrite: 1

  # Maximum replication lag in seconds before a replica is considered unhealthy
  minReplicasMaxLag: 10

  persistence:
    size: 2Gi
    storageClass: ceph-filesystem
    accessModes:
      - ReadWriteOnce

  # PersistentVolumeClaim retention policy for StatefulSet
  # Controls when PVCs are deleted (requires Kubernetes 1.23+)
  # More info: https://kubernetes.io/docs/concepts/workloads/controllers/statefulset/#persistentvolumeclaim-retention
  persistentVolumeClaimRetentionPolicy: {}

tls:
  # Enable TLS
  enabled: false
  # Name of the Secret containing TLS keys (required)
  existingSecret: ""
  # Secret key name containing server public certificate
  serverPublicKey: server.crt
  # Secret key name containing server private key
  serverKey: server.key
  # Secret key name containing Certificate Authority public certificate
  caPublicKey: ca.crt
  # Secret key name containing DH parameters (optional)
  dhParamKey: ""
  # Require that clients authenticate with a certificate
  requireClientCertificate: false

affinity:
  podAntiAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
    - podAffinityTerm:
       topologyKey: kubernetes.io/hostname
      weight: 1

# Valkey logging level: debug, verbose, notice, warning
valkeyLogLevel: "info"

# Environment variables to inject into Valkey container
env: {}
  # Example:
  # LOG_LEVEL: info

metrics:
  enabled: true

  service:
    enabled: true

  serviceMonitor:
    enabled: true
